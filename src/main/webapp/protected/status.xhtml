<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <f:metadata>  
        <f:viewAction id="loadData" action="#{mT_StatusController.loadDataList()}" phase="INVOKE_APPLICATION" >
        </f:viewAction> 
        <f:viewAction id="defaultControlVariables" action="#{mT_StatusController.defaultValueControlVariablesIni()}" phase="INVOKE_APPLICATION" >
        </f:viewAction>   
    </f:metadata>

    <h:body>        

        <ui:composition id="mainTemplate" template="./../resources/templates/mainTemplate.xhtml">
            <ui:define id="title" name="title">#{pages.T_ENTITIES_STATUS} </ui:define>
            <ui:define id="content" name="content">   
                <h:form id="form"  >  
                    <p:growl id="messageGrowl"  showDetail="true" autoUpdate="true"  /> 

                    <p:remoteCommand id="remoteCommandUpdateTable" name="updateTable"  process="@this" update="form:table" />

                    <p:dataTable id="table" var="data" 
                                 value="#{mT_StatusController.dataList}"                                     
                                 emptyMessage="Any status for this criteria"
                                 resizableColumns="true" 
                                 scrollable="true"  scrollWidth="100%" 
                                 paginator="true"                                      
                                 tableStyle="table-layout:fixed;width:100%;"
                                 rows="10"     
                                 editable="true"  
                                 rowIndexVar="rowIndex"  
                                 widgetVar="filteredTable"
                                 filteredValue="#{mT_StatusController.filteredDataList}"
                                 selection="#{mT_StatusController.selectedData}">                            

                        <f:facet id="facetHeader" name="header">  
                            Status
                            <p>
                                <p:commandButton id="createButton" 
                                                 value="New status"
                                                 title="Create a new status for the promotions" 
                                                 action="#{mT_StatusController.pushNewButton()}" 
                                                 update=":form:createDialogPanelData"
                                                 rendered="#{mT_StatusController.canUserEditModify()}"
                                                 process="@this"> 
                                </p:commandButton>
                            </p>

                        </f:facet>  
                        <f:facet id="facetFooter" name="footer">                                 
                        </f:facet> 


                        <p:ajax id="ajaxRowEditInit" event="rowEditInit"  listener="#{mT_StatusController.onRowInit}"  />
                        <p:ajax id="ajaxRowEdit" event="rowEdit" listener="#{mT_StatusController.onRowEdit}"  update="form:messageGrowl"                                                                                               
                                oncomplete="if (!args.validationFailed) {updateTable();}">                            
                        </p:ajax>
                        <p:ajax id="ajaxRowEditCancel" event="rowEditCancel" listener="#{mT_StatusController.onRowCancel}" update="form:messageGrowl" 
                                oncomplete="if (!args.validationFailed) {updateTable();}"/>


                        <!-- EDIT COLUMS -->   
                        <p:column  id="deleteRow"
                                   style="font-family:Arial Black;
                                   text-align: center;
                                   font-size: 12px;
                                   width: 20px;    
                                   overflow: hidden"
                                   headerText="DEL ROW" 
                                   rendered="#{mT_StatusController.canUserEditModify()}"
                                   >
                            <p:commandButton  id="deleteButton" icon="fa fa-trash" 
                                              actionListener="#{mT_StatusController.pushDeleteButton}"
                                              immediate="true" 
                                              onclick="PF('deleteConfirmDialog').show()"
                                              disabled="#{mT_StatusController.editingMode}"
                                              oncomplete="if(!args.validationFailed) {updateTable();}"
                                              rendered="#{mT_StatusController.canUserEditModify()}"                                
                                              >     
                                <f:param id="currentRow" name="currentRow" value="#{rowIndex}" />
                            </p:commandButton>

                        </p:column>

                        <p:column id="editRow" 
                                  style="font-family:Arial Black;
                                  text-align: center;
                                  font-size: 12px;
                                  width: 20px;    
                                  overflow: hidden"
                                  headerText="EDIT ROW" 
                                  rendered="#{mT_StatusController.canUserEditModify()}"
                                  >
                            <p:rowEditor id="editButton" rendered="#{mT_StatusController.canUserEditModify()}" >                               
                            </p:rowEditor>                 
                        </p:column>

                        <!-- DATA TABLE -->
                        <p:column id="statusId" 
                                  style="font-family:Arial Black;
                                  text-align: left;
                                  font-size: 12px;
                                  width: 70px;    
                                  overflow: hidden;
                                  visibility: hidden"
                                  headerText="#{tables.MT_STATUS_STATUS_ID}"                                       
                                  rendered="false" >
                            <h:outputText value="#{data.statusId}" />
                        </p:column>    


                        <p:column id="entityTypeId"                                  
                                  style="font-family:Arial Black;
                                  text-align: left;
                                  font-size: 12px;
                                  width: 50px;    
                                  overflow: hidden"                                  
                                  headerText="#{tables.MT_STATUS_ENTITY_TYPE_CODE}" 
                                  rendered="true"
                                  filterBy="#{data.entityTypeId}"
                                  filterMatchMode="exact">                             
                            <f:facet id="filterEntityType" name="filter" >  
                                <p:selectOneMenu id="filterMenuEntityType" onchange="PF('filteredTable').filter()" >
                                    <f:selectItem id="filterSelectItemEntityType" itemLabel="[ALL ENTITIES]" itemValue="#{null}" noSelectionOption="true" />
                                    <f:selectItems id="filterSelectItemsEntityType" value="#{mT_StatusController.populateEntityTypeMenu()}" />
                                </p:selectOneMenu>
                            </f:facet>

                            <p:cellEditor id="cellEditorEntityTypeId">
                                <f:facet id="facetEntityTypeIdOutput" name="output">  
                                    <p:selectOneMenu id="EntityTypeOutput" 
                                                     editable="false" disabled="true"
                                                     immediate="true"
                                                     value="#{data.entityTypeId}"
                                                     >                                         
                                        <f:selectItems value="#{mT_StatusController.populateEntityTypeMenu()}"       
                                                       id="selectItemsEntityTypeOutput"
                                                       itemDisabled="true"
                                                       var="selectedEntityTypeOutput"                                                       
                                                       itemValue="#{data.entityTypeId}"
                                                       />                                            
                                    </p:selectOneMenu>    
                                </f:facet>  
                                <f:facet id="facetEntityTypeIdInput" name="input">  
                                    <p:selectOneMenu id="EntityTypeInput" value="#{data.entityTypeId}"                                                       
                                                     immediate="true"                                                     
                                                     >                                                
                                        <f:selectItems value="#{mT_StatusController.populateEntityTypeMenu()}"
                                                       id="selectItemsEntityTypeInput"
                                                       var="selectEntityTypeInput" 
                                                       itemValue="#{data.entityTypeId}" >

                                        </f:selectItems>
                                       
                                        <p:ajax event="change" immediate="true"   update="EntityTypeOutput"   />

                                    </p:selectOneMenu>
                                </f:facet>  
                            </p:cellEditor>
                        </p:column>  

                        <p:column id="statusCode" 
                                  style="font-family:Arial Black;
                                  text-align: left;
                                  font-size: 12px;
                                  width: 50px;    
                                  overflow: hidden"
                                  headerText="#{tables.MT_STATUS_STATUS_CODE}"                                        
                                  rendered="true"
                                  filterBy="#{data.statusCode}"  
                                  filterMatchMode="contains"
                                  >                          
                            <h:outputText id="filterStatusCode" value="" />
                            
                            <p:cellEditor id="cellEditorStatusCode">
                                <f:facet id="facetStatusCodeOutput" name="output">  
                                    <h:outputText id="statusCodeOutput" value="#{data.statusCode}"/>  
                                </f:facet>  
                                <f:facet id="facetStatusCodeInput" name="input">  
                                    <p:inputText id="statusCodeInput" 
                                                 label="Status Code"
                                                 value="#{data.statusCode}" style="width:96%"
                                                 required="true" requiredMessage="Status Code can't be null">  
                                        <f:validateLength  minimum="1" maximum="10"/>
                                        <p:ajax event="change" update="statusCodeOutput" />
                                    </p:inputText>
                                </f:facet>  
                            </p:cellEditor>
                        </p:column>
                        
                        <p:column id="description" 
                                  style="font-family:Arial Black;
                                  text-align: left;
                                  font-size: 12px;
                                  width: 200px;    
                                  overflow: hidden"
                                  headerText="#{tables.MT_STATUS_DESCRIPTION}" 
                                  rendered="true" 
                                  filterBy="#{data.description}"  
                                  filterMatchMode="contains"
                                  >                          
                            <h:outputText id="filterDescription" value="" />
                            
                            <p:cellEditor id="cellEditorStatusDescription">
                                <f:facet id="facetStatusDescriptionOutput" name="output">  
                                    <h:outputText id="statusDescriptionOutput" value="#{data.description}"/>  
                                </f:facet>  
                                <f:facet id="facetStatusDescription" name="input">  
                                    <p:inputText id="statusDescriptionInput" 
                                                 label="Discount Description"
                                                 value="#{data.description}" style="width:96%"
                                                 required="true" requiredMessage="Status Description can't be null"> 
                                        <f:validateLength  minimum="1" maximum="100"/>
                                        <p:ajax event="change" update="statusDescriptionOutput" />
                                    </p:inputText>
                                </f:facet>  
                            </p:cellEditor>
                        </p:column>


                    </p:dataTable>
                    <!-- New data dialog-->	
                    <p:dialog id="createDialog"     
                              header="Create new Status"                              
                              widgetVar="createDialog">                            

                        <h:panelGrid id="createDialogPanelData" columns="2" cellpadding="5">
                            <p:outputLabel id="newEntityTypeIdLabel" value="Entity Type Code: " />
                            <p:selectOneMenu id="EntityType"                                             
                                             immediate="true"
                                             value="#{mT_StatusController.injectStatus.entityTypeId}">                                         
                                <f:selectItems value="#{mT_StatusController.populateEntityTypeMenu()}"       
                                               id="selectItemsEntityType"
                                               var="Entity Type Code"                                                       
                                               itemValue="#{mT_StatusController.injectStatus.entityTypeId}"
                                               />                                            
                            </p:selectOneMenu>   

                            <p:outputLabel id="newStatusCodeLabel" value="Status Code: " />
                            <p:inputText id="newStatusCodeInput" label="Status Code" 
                                         value="#{mT_StatusController.injectStatus.statusCode}">                                 
                            </p:inputText>

                            <p:outputLabel id="newStatusDescriptionLabel"  value="Description: " />
                            <p:inputText id="newStatusDescriptionInput" 
                                         label="Description" 
                                         value="#{mT_StatusController.injectStatus.description}">                                 
                            </p:inputText>
                        </h:panelGrid>
                        <h:panelGrid id="createDialogPanelButtons" columns="3" cellpadding="5">
                            <p:commandButton value="#{properties.L_OK}" 
                                             actionListener="#{mT_StatusController.createNew()}"                                                   
                                             styleClass="ui-confirmdialog-yes" 
                                             update="form:table"
                                             icon="#{properties.I_OK}">
                            </p:commandButton>
                            <p:commandButton value="#{properties.L_CANCEL}"                                                  
                                             styleClass="ui-confirmdialog-no" 
                                             oncomplete="PF('createDialog').hide()" 
                                             icon="#{properties.I_CANCEL}"
                                             actionListener="#{mT_StatusController.pushResetButton}">
                            </p:commandButton>
                            <p:commandButton id="createDialogClear" 
                                             value="Clear" 
                                             icon="#{properties.F_I_CLEAR}" 
                                             update="createDialogPanelData"
                                             process="@this"
                                             actionListener="#{mT_StatusController.pushResetButton}" >
                            </p:commandButton>
                        </h:panelGrid>

                    </p:dialog> 

                    <!-- Delete confirm dialog -->	
                    <p:confirmDialog global="true" 
                                     styleClass="change-position" 
                                     widgetVar="deleteConfirmDialog"
                                     header="DELETE ROW"
                                     message="Do you really want to delete this row?
                                     (The row was inmediately delete on the system)"
                                     >
                        <p:commandButton id="okDeleteConfirmDialog" value="#{properties.L_OK}"                                           
                                         styleClass="ui-confirmdialog-yes" 
                                         actionListener="#{mT_StatusController.deleteRow}"
                                         oncomplete="PF('deleteConfirmDialog').hide()" 
                                         process="@this"  
                                         update="form:table"
                                         icon="#{properties.I_OK}"/>
                        <p:commandButton id="cancelDeleteConfirmDialog"
                                         value="#{properties.L_CANCEL}"                                         
                                         styleClass="ui-confirmdialog-no"    
                                         oncomplete="PF('deleteConfirmDialog').hide()"     
                                         type="button"
                                         process="@this"  
                                         icon="#{properties.I_CANCEL}"/>
                    </p:confirmDialog> 
                </h:form>
            </ui:define>
        </ui:composition>
    </h:body>
</html>