<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <f:metadata>  
        <f:viewAction id="loadData" action="#{mT_ApplicationUnitController.loadDataList()}" phase="INVOKE_APPLICATION" >
        </f:viewAction> 
        <f:viewAction id="defaultControlVariables" action="#{mT_ApplicationUnitController.defaultValueControlVariablesIni()}" phase="INVOKE_APPLICATION" >
        </f:viewAction>   
    </f:metadata>

    <h:body>        

        <ui:composition id="mainTemplate" template="./../resources/templates/mainTemplate.xhtml">
            <ui:define id="title" name="title">#{pages.T_PARAMETRICS_APPLICATION_UNIT} </ui:define>
            <ui:define id="content" name="content">   
                <h:form id="form"  >  
                    <p:growl id="messageGrowl"  showDetail="true" autoUpdate="true"  /> 

                    <p:remoteCommand id="remoteCommandUpdateTable" name="updateTable"  process="@this" update="form:table" />

                    <p:dataTable id="table" var="data" 
                                 value="#{mT_ApplicationUnitController.dataList}"                                     
                                 emptyMessage="Any application unit for this criteria"
                                 resizableColumns="true" 
                                 scrollable="true"  scrollWidth="100%" 
                                 paginator="true"                                      
                                 tableStyle="table-layout:fixed;width:100%;"
                                 rows="10"     
                                 editable="true"  
                                 rowIndexVar="rowIndex"                                    
                                 selection="#{mT_ApplicationUnitController.selectedData}">                            

                        <f:facet id="facetHeader" name="header">  
                            Application Unit for the Promotions    
                            <p>
                                <p:commandButton id="createButton" 
                                                 value="New application unit"
                                                 title="Create a new application unit for the promotions" 
                                                 action="#{mT_ApplicationUnitController.pushNewButton()}" 
                                                 update=":form:createDialogPanelData"
                                                 rendered="#{mT_ApplicationUnitController.canUserEditModify()}"
                                                 process="@this"> 
                                </p:commandButton>
                            </p>
                        </f:facet>  
                        <f:facet id="facetFooter" name="footer">                                 
                        </f:facet> 


                        <p:ajax id="ajaxRowEditInit" event="rowEditInit"  listener="#{mT_ApplicationUnitController.onRowInit}"  />
                        <p:ajax id="ajaxRowEdit" event="rowEdit" listener="#{mT_ApplicationUnitController.onRowEdit}"  update="form:messageGrowl"                                                                                               
                                oncomplete="if (!args.validationFailed) {updateTable();}">                            
                        </p:ajax>
                        <p:ajax id="ajaxRowEditCancel" event="rowEditCancel" listener="#{mT_ApplicationUnitController.onRowCancel}" update="form:messageGrowl" 
                                oncomplete="if (!args.validationFailed) {updateTable();}"/>


                        <!-- EDIT COLUMS -->   
                        <p:column  id="deleteRow"
                                   style="font-family:Arial Black;
                                   text-align: center;
                                   font-size: 12px;
                                   width: 20px;    
                                   overflow: hidden"
                                   headerText="DEL ROW" 
                                   rendered="#{mT_ApplicationUnitController.canUserEditModify()}"
                                   >
                            <p:commandButton  id="deleteButton" icon="fa fa-trash" 
                                              actionListener="#{mT_ApplicationUnitController.pushDeleteButton}"
                                              immediate="true" 
                                              onclick="PF('deleteConfirmDialog').show()"
                                              disabled="#{mT_ApplicationUnitController.editingMode}"
                                              oncomplete="if(!args.validationFailed) {updateTable();}"
                                              rendered="#{mT_ApplicationUnitController.canUserEditModify()}"                                
                                              >     
                                <f:param id="currentRow" name="currentRow" value="#{rowIndex}" />
                            </p:commandButton>

                        </p:column>

                        <p:column id="editRow" 
                                  style="font-family:Arial Black;
                                  text-align: center;
                                  font-size: 12px;
                                  width: 20px;    
                                  overflow: hidden"
                                  headerText="EDIT ROW" 
                                  rendered="#{mT_ApplicationUnitController.canUserEditModify()}"
                                  >
                            <p:rowEditor id="editButton" rendered="#{mT_ApplicationUnitController.canUserEditModify()}" >                               
                            </p:rowEditor>                 
                        </p:column>

                        <!-- DATA TABLE -->

                        <p:column id="applicationUnitId" 
                                  style="font-family:Arial Black;
                                  text-align: left;
                                  font-size: 12px;
                                  width: 70px;    
                                  overflow: hidden;
                                  visibility: hidden"
                                  headerText="#{tables.MT_APPLICATION_UNIT_APPLICATION_UNIT_ID}"                                       
                                  rendered="false" >
                            <h:outputText value="#{data.applicationUnitId}" />
                        </p:column>    
                        <p:column id="applicationUnitCode" 
                                  style="font-family:Arial Black;
                                  text-align: left;
                                  font-size: 12px;
                                  width: 100px;    
                                  overflow: hidden"
                                  headerText="#{tables.MT_APPLICATION_UNIT_APPLICATION_UNIT_CODE}"                                        
                                  rendered="true" 
                                  filterBy="#{data.applicationUnitCode}"  
                                  filterMatchMode="contains">
                            <h:outputText id="filterApplicationUnitCode" value="" />
                                  
                            <p:cellEditor id="cellEditorApplicationUnitCode">
                                <f:facet id="facetApplicationUnitCodeOutput" name="output">  
                                    <h:outputText id="applicationUnitCodeOutput" value="#{data.applicationUnitCode}"/>  
                                </f:facet>  
                                <f:facet id="facetApplicationUnitCodeInput" name="input">  
                                    <p:inputText id="applicationUnitCodeInput" 
                                                 label="Unit Code"
                                                 value="#{data.applicationUnitCode}" style="width:96%"
                                                 required="true" requiredMessage="Application Unit Code can't be null">  
                                        <f:validateLength  minimum="1" maximum="10"/>
                                        <p:ajax event="change" update="applicationUnitCodeOutput" />
                                    </p:inputText>
                                </f:facet>  
                            </p:cellEditor>
                        </p:column>
                        <p:column id="applicationUnitDescription" 
                                  style="font-family:Arial Black;
                                  text-align: left;
                                  font-size: 12px;
                                  width: 200px;    
                                  overflow: hidden"
                                  headerText="#{tables.MT_APPLICATION_UNIT_DESCRIPTION}" 
                                  rendered="true" 
                                  filterBy="#{data.description}"  
                                  filterMatchMode="contains">        
                            
                            <h:outputText id="filterDescription" value="" />
                                                                  
                            <p:cellEditor id="cellEditorApplicationUnitDescription">
                                <f:facet id="facetApplicationUnitDescriptionOutput" name="output">  
                                    <h:outputText id="applicationUnitDescriptionOutput" value="#{data.description}"/>  
                                </f:facet>  
                                <f:facet id="facetApplicationUnitDescription" name="input">  
                                    <p:inputText id="applicationUnitDescriptionInput" 
                                                 label="Unit Description"
                                                 value="#{data.description}" style="width:96%"
                                                 required="true" requiredMessage="Application Unit Description can't be null">  
                                        <f:validateLength  minimum="1" maximum="100"/>
                                        <p:ajax event="change" update="applicationUnitDescriptionOutput" />
                                    </p:inputText>
                                </f:facet>  
                            </p:cellEditor>
                        </p:column>


                    </p:dataTable>
                    <!-- New data dialog-->	
                    <p:dialog id="createDialog" 
                              header="Create new Application Unit"
                              widgetVar="createDialog">                            
                        <h:panelGrid id="createDialogPanelData" columns="2" cellpadding="5">
                            <p:outputLabel id="newApplicationUnitCodeLabel" value="Unit Code: " />
                            <p:inputText id="newApplicationUnitCodeInput" 
                                         label="Unit Code" 
                                         value="#{mT_ApplicationUnitController.injectApplicationUnit.applicationUnitCode}">                                
                            </p:inputText>

                            <p:outputLabel id="newApplicationUnitDescriptionLabel"  value="Description: " />
                            <p:inputText id="newApplicationUnitDescriptionInput" label="Unit Description" 
                                         value="#{mT_ApplicationUnitController.injectApplicationUnit.description}">                                
                            </p:inputText>

                        </h:panelGrid>
                        <p></p>
                        <h:panelGrid id="createDialogPanelButtons" columns="3" cellpadding="5">
                            <p:commandButton value="#{properties.L_OK}" 
                                             actionListener="#{mT_ApplicationUnitController.createNew()}"                                                   
                                             styleClass="ui-confirmdialog-yes" 
                                             update="form:table"
                                             icon="#{properties.I_OK}">
                            </p:commandButton>
                            <p:commandButton value="#{properties.L_CANCEL}"                                                  
                                             styleClass="ui-confirmdialog-no" 
                                             oncomplete="PF('createDialog').hide()" 
                                             icon="#{properties.I_CANCEL}"
                                             actionListener="#{mT_ApplicationUnitController.pushResetButton}">
                            </p:commandButton>
                            <p:commandButton id="createDialogClear" 
                                             value="Clear" 
                                             icon="#{properties.F_I_CLEAR}" 
                                             update="createDialogPanelData"
                                             process="@this"
                                             actionListener="#{mT_ApplicationUnitController.pushResetButton}" >
                            </p:commandButton>
                        </h:panelGrid>
                    </p:dialog> 

                    <!-- Delete confirm dialog -->	
                    <p:confirmDialog global="true" 
                                     styleClass="change-position" 
                                     widgetVar="deleteConfirmDialog"
                                     header="DELETE ROW"
                                     message="Do you really want to delete this row?
                                     (The row was inmediately delete on the system)"
                                     >
                        <p:commandButton id="okDeleteConfirmDialog" value="#{properties.L_OK}"                                           
                                         styleClass="ui-confirmdialog-yes" 
                                         actionListener="#{mT_ApplicationUnitController.deleteRow}"
                                         oncomplete="PF('deleteConfirmDialog').hide()" 
                                         process="@this"  
                                         update="form:table"
                                         icon="#{properties.I_OK}"/>
                        <p:commandButton id="cancelDeleteConfirmDialog"
                                         value="#{properties.L_CANCEL}"                                         
                                         styleClass="ui-confirmdialog-no"    
                                         oncomplete="PF('deleteConfirmDialog').hide()"     
                                         type="button"
                                         process="@this"  
                                         icon="#{properties.I_CANCEL}"/>                        
                    </p:confirmDialog> 
                </h:form>
            </ui:define>
        </ui:composition>
    </h:body>
</html>