<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <f:metadata>  
        <f:viewAction id="loadData" action="#{mT_ApplicationLevelController.loadDataList()}" phase="INVOKE_APPLICATION" >
        </f:viewAction> 
        <f:viewAction id="defaultControlVariables" action="#{mT_ApplicationLevelController.defaultValueControlVariablesIni()}" phase="INVOKE_APPLICATION" >
        </f:viewAction>   
    </f:metadata>

    <h:body>        

        <ui:composition id="mainTemplate" template="./../resources/templates/mainTemplate.xhtml">
            <ui:define id="title" name="title">#{pages.T_PARAMETRICS_APPLICATION_LEVEL} </ui:define>
            <ui:define id="content" name="content">   
                <h:form id="form"  >  
                    <p:growl id="messageGrowl"  showDetail="true" autoUpdate="true"  /> 

                    <p:remoteCommand id="remoteCommandUpdateTable" name="updateTable"  process="@this" update="form:table" />

                    <p:dataTable id="table" var="data" 
                                 value="#{mT_ApplicationLevelController.dataList}"                                     
                                 emptyMessage="Any application level for this criteria"
                                 resizableColumns="true" 
                                 scrollable="true"  scrollWidth="100%" 
                                 paginator="true"                                      
                                 tableStyle="table-layout:fixed;width:100%;"
                                 rows="10"     
                                 editable="true"  
                                 rowIndexVar="rowIndex"                                    
                                 selection="#{mT_ApplicationLevelController.selectedData}">                            

                        <f:facet id="facetHeader" name="header">  
                            Application Level for the Promotions    
                            <p>
                                <p:commandButton id="createButton" 
                                                 value="New application level"
                                                 title="Create a new application level for the promotions" 
                                                 action="#{mT_ApplicationLevelController.pushNewButton()}" 
                                                 update=":form:createDialogPanelData"
                                                 rendered="#{mT_ApplicationLevelController.canUserEditModify()}"
                                                 process="@this"> 
                                </p:commandButton>
                            </p>
                        </f:facet>  
                        <f:facet id="facetFooter" name="footer">                                 
                        </f:facet> 


                        <p:ajax id="ajaxRowEditInit" event="rowEditInit"  listener="#{mT_ApplicationLevelController.onRowInit}"  />
                        <p:ajax id="ajaxRowEdit" event="rowEdit" listener="#{mT_ApplicationLevelController.onRowEdit}"  update="form:messageGrowl"                                                                                               
                                oncomplete="if (!args.validationFailed) {updateTable();}">                            
                        </p:ajax>
                        <p:ajax id="ajaxRowEditCancel" event="rowEditCancel" listener="#{mT_ApplicationLevelController.onRowCancel}" update="form:messageGrowl" 
                                oncomplete="if (!args.validationFailed) {updateTable();}"/>


                        <!-- EDIT COLUMS -->   
                        <p:column  id="deleteRow"
                                   style="font-family:Arial Black;
                                   text-align: center;
                                   font-size: 12px;
                                   width: 20px;    
                                   overflow: hidden"
                                   headerText="DEL ROW" 
                                   rendered="#{mT_ApplicationLevelController.canUserEditModify()}"
                                   >
                            <p:commandButton  id="deleteButton" icon="fa fa-trash" 
                                              actionListener="#{mT_ApplicationLevelController.pushDeleteButton}"
                                              immediate="true" 
                                              onclick="PF('deleteConfirmDialog').show()"
                                              disabled="#{mT_ApplicationLevelController.editingMode}"
                                              oncomplete="if(!args.validationFailed) {updateTable();}"
                                              rendered="#{mT_ApplicationLevelController.canUserEditModify()}"                                
                                              >     
                                 <f:param id="currentRow" name="currentRow" value="#{rowIndex}" />
                            </p:commandButton>

                        </p:column>

                        <p:column id="editRow" 
                                  style="font-family:Arial Black;
                                  text-align: center;
                                  font-size: 12px;
                                  width: 20px;    
                                  overflow: hidden"
                                  headerText="EDIT ROW" 
                                  rendered="#{mT_ApplicationLevelController.canUserEditModify()}"
                                  >
                            <p:rowEditor id="editButton" rendered="#{mT_ApplicationLevelController.canUserEditModify()}" >                               
                            </p:rowEditor>                 
                        </p:column>

                        <!-- DATA TABLE -->

                        <p:column id="applicationLevelId" 
                                  style="font-family:Arial Black;
                                  text-align: left;
                                  font-size: 12px;
                                  width: 20px;    
                                  overflow: hidden;
                                  visibility: hidden"
                                  headerText="#{tables.MT_APPLICATION_LEVEL_APPLICATION_LEVEL_ID}"                                       
                                  rendered="false" >
                            <h:outputText value="#{data.applicationLevelId}" />
                        </p:column>    
                        <p:column id="applicationLevelCode" 
                                  style="font-family:Arial Black;
                                  text-align: left;
                                  font-size: 12px;
                                  width: 100px;    
                                  overflow: hidden"
                                  headerText="#{tables.MT_APPLICATION_LEVEL_APPLICATION_LEVEL_CODE}"                                        
                                  rendered="true" 
                                  filterBy="#{data.applicationLevelCode}"  
                                  filterMatchMode="contains">
                            <h:outputText id="filterApplicationLevelCode" value="" />
                            
                            <p:cellEditor id="cellEditorApplicationLevelCode">
                                <f:facet id="facetApplicationLevelCodeOutput" name="output">  
                                    <h:outputText id="applicationLevelCodeOutput" value="#{data.applicationLevelCode}"/>  
                                </f:facet>  
                                <f:facet id="facetApplicationLevelCodeInput" name="input">  
                                    <p:inputText id="applicationLevelCodeInput"
                                                 label="Level Code"
                                                 value="#{data.applicationLevelCode}" style="width:96%"
                                                 required="true" requiredMessage="Application Level Code can't be null">  
                                        <f:validateLength  minimum="1" maximum="10"/>
                                        <p:ajax event="change" update="applicationLevelCodeOutput" />
                                    </p:inputText>
                                </f:facet>  
                            </p:cellEditor>
                        </p:column>
                        <p:column id="applicationLevelDescription" 
                                  style="font-family:Arial Black;
                                  text-align: left;
                                  font-size: 12px;
                                  width: 200px;    
                                  overflow: hidden"
                                  headerText="#{tables.MT_APPLICATION_LEVEL_DESCRIPTION}" 
                                  rendered="true" 
                                  filterBy="#{data.description}"  
                                  filterMatchMode="contains">        
                            
                            <h:outputText id="filterDescription" value="" />
                            
                            <p:cellEditor id="cellEditorApplicationLevelDescription">
                                <f:facet id="facetApplicationLevelDescriptionOutput" name="output">  
                                    <h:outputText id="applicationLevelDescriptionOutput" value="#{data.description}"/>  
                                </f:facet>  
                                <f:facet id="facetApplicationLevelDescription" name="input">  
                                    <p:inputText id="applicationLevelDescriptionInput" 
                                                 label="Level Description"
                                                 value="#{data.description}" style="width:96%"
                                                 required="true" requiredMessage="Application Level Description can't be null">  >                                         
                                        <f:validateLength  minimum="1" maximum="100"/>
                                        <p:ajax event="change" update="applicationLevelDescriptionOutput" />
                                    </p:inputText>
                                </f:facet>  
                            </p:cellEditor>
                        </p:column>


                    </p:dataTable>
                    <!-- New data dialog-->	
                    <p:dialog id="createDialog"     
                              header="Create new Application Level"                              
                              widgetVar="createDialog">                            

                        <h:panelGrid id="createDialogPanelData" columns="2" cellpadding="5">
                            <p:outputLabel id="newApplicationLevelCodeLabel" value="Level Code: " />
                            <p:inputText id="newApplicationLevelCodeInput" label="Level Code" 
                                         value="#{mT_ApplicationLevelController.injectApplicationLevel.applicationLevelCode}">                                
                            </p:inputText>

                            <p:outputLabel id="newApplicationLevelDescriptionLabel"  value="Description: " />
                            <p:inputText id="newApplicationLevelDescriptionInput" label="Level Description" 
                                         value="#{mT_ApplicationLevelController.injectApplicationLevel.description}">
                            </p:inputText>
                        </h:panelGrid>
                        <h:panelGrid id="createDialogPanelButtons" columns="3" cellpadding="5">
                            <p:commandButton value="#{properties.L_OK}" 
                                             actionListener="#{mT_ApplicationLevelController.createNew()}"                                                   
                                             styleClass="ui-confirmdialog-yes" 
                                             update="form:table"
                                             icon="#{properties.I_OK}">
                            </p:commandButton>
                            <p:commandButton value="#{properties.L_CANCEL}"                                                  
                                             styleClass="ui-confirmdialog-no" 
                                             oncomplete="PF('createDialog').hide()" 
                                             icon="#{properties.I_CANCEL}"
                                             actionListener="#{mT_ApplicationLevelController.pushResetButton}">
                            </p:commandButton>
                            <p:commandButton id="createDialogClear" 
                                             value="Clear" 
                                             icon="#{properties.F_I_CLEAR}" 
                                             update="createDialogPanelData"
                                             process="@this"
                                             actionListener="#{mT_ApplicationLevelController.pushResetButton}" >
                            </p:commandButton>
                        </h:panelGrid>

                    </p:dialog> 

                    <!-- Delete confirm dialog -->	
                    <p:confirmDialog global="true" 
                                     styleClass="change-position" 
                                     widgetVar="deleteConfirmDialog"
                                     header="DELETE ROW"
                                     message="Do you really want to delete this row?
                                     (The row was inmediately delete on the system)"
                                     >
                        <p:commandButton id="okDeleteConfirmDialog" value="#{properties.L_OK}"                                           
                                         styleClass="ui-confirmdialog-yes" 
                                         actionListener="#{mT_ApplicationLevelController.deleteRow}"
                                         oncomplete="PF('deleteConfirmDialog').hide()" 
                                         process="@this"  
                                         update="form:table"
                                         icon="#{properties.I_OK}"/>
                        <p:commandButton id="cancelDeleteConfirmDialog"
                                         value="#{properties.L_CANCEL}"                                         
                                         styleClass="ui-confirmdialog-no"    
                                         oncomplete="PF('deleteConfirmDialog').hide()"     
                                         type="button"
                                         process="@this"  
                                         icon="#{properties.I_CANCEL}"/>
                    </p:confirmDialog> 
                </h:form>
            </ui:define>
        </ui:composition>
    </h:body>
</html>